/*
	ES.MapLib 0.1.0, a js library for exsun lbs instance.
	(c) 2016-2018, liulin
	武汉依迅
	http://www.exsun.cn/
*/

!function(t,e,i){i.MapLib={},i.MapLib.Version="0.2.0",i.MapLib.Tooltip=i.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane;var e=i.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane);this._container=e,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(i.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(i.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),o=this._container;return this._container&&(o.style.visibility="inherit",i.DomUtil.setPosition(o,e)),this},showAsError:function(){return this._container&&i.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&i.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),i.extend(i.SVG,{_initContainer:function(){this._container=i.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=i.SVG.create("g"),this._container.appendChild(this._rootGroup);var t=this._createArrow();this._container.appendChild(t)},_createArrow:function(){var t=i.Path.prototype._createElement("defs"),e=i.Path.prototype._createElement("marker");e.setAttribute("id","arrow"),e.setAttribute("markerUnits","strokeWidth"),e.setAttribute("markerWidth","8"),e.setAttribute("markerHeight","8"),e.setAttribute("viewBox","0 0 12 12"),e.setAttribute("refX","6"),e.setAttribute("refY","6"),e.setAttribute("orient","auto");var o=i.Path.prototype._createElement("path");return o.setAttribute("d","M2,2 L10,6 L2,10 L3,6 L2,2"),o.setAttribute("style","fill: red;"),t.appendChild(e),e.appendChild(o),t}}),i.Circle.include({getDueLat:function(){var t=Math.PI/180,e=this._mRadius/i.CRS.Earth.R/t;return e}}),i.Map.mergeOptions({touchExtend:!0}),i.Map.TouchExtend=i.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){i.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),i.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),i.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(i.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),i.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),i.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),i.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(i.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),i.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){i.DomEvent.off(this._container,"touchstart",this._onTouchStart),i.DomEvent.off(this._container,"touchend",this._onTouchEnd),i.DomEvent.off(this._container,"touchmove",this._onTouchMove),this._detectIE()?(i.DomEvent.off(this._container,"MSPointerDowm",this._onTouchStart),i.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd),i.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove),i.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel)):(i.DomEvent.off(this._container,"touchcancel",this._onTouchCancel),i.DomEvent.off(this._container,"touchleave",this._onTouchLeave))},_touchEvent:function(t,e){var i={};if("undefined"!=typeof t.touches){if(!t.touches.length)return;i=t.touches[0]}else{if("touch"!==t.pointerType)return;if(i=t,!this._filterClick(t))return}var o=this._map.mouseEventToContainerPoint(i),a=this._map.mouseEventToLayerPoint(i),s=this._map.layerPointToLatLng(a);this._map.fire(e,{latlng:s,layerPoint:a,containerPoint:o,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,o=i.DomEvent._lastClick&&e-i.DomEvent._lastClick;return o&&o>100&&500>o||t.target._simulatedClick&&!t._simulated?(i.DomEvent.stop(t),!1):(i.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){if(this._map._loaded){var e="touchstart";this._touchEvent(t,e)}},_onTouchEnd:function(t){if(this._map._loaded){var e="touchend";this._touchEvent(t,e)}},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){if(this._map._loaded){var e="touchleave";this._touchEvent(t,e)}},_onTouchMove:function(t){if(this._map._loaded){var e="touchmove";this._touchEvent(t,e)}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var o=e.indexOf("Trident/");if(o>0){var a=e.indexOf("rv:");return parseInt(e.substring(a+3,e.indexOf(".",a)),10)}var s=e.indexOf("Edge/");return s>0?parseInt(e.substring(s+5,e.indexOf(".",s)),10):!1}}),i.Map.addInitHook("addHandler","touchExtend",i.Map.TouchExtend),i.Marker.Touch=i.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?i.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),i.DomUtil.addClass(t,"leaflet-clickable"),i.DomEvent.on(t,"click",this._onMouseClick,this),i.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var o=0;o<e.length;o++)i.DomEvent.on(t,e[o],this._fireMouseEvent,this);i.Handler.MarkerDrag&&(this.dragging=new i.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var o=e.indexOf("Trident/");if(o>0){var a=e.indexOf("rv:");return parseInt(e.substring(a+3,e.indexOf(".",a)),10)}var s=e.indexOf("Edge/");return s>0?parseInt(e.substring(s+5,e.indexOf(".",s)),10):!1}}),i.LatLngUtil={cloneLatLngs:function(t){for(var e=[],o=0,a=t.length;a>o;o++)Array.isArray(t[o])?e.push(i.LatLngUtil.cloneLatLngs(t[o])):e.push(this.cloneLatLng(t[o]));return e},cloneLatLng:function(t){return i.latLng(t.lat,t.lng)}},i.GeometryUtil=i.extend(i.GeometryUtil||{},{geodesicAreaEx:function(t){var e,i,o=t.length,a=0,s=Math.PI/180;if(o>2){for(var n=0;o>n;n++)e=t[n],i=t[(n+1)%o],a+=(i.lng-e.lng)*s*(2+Math.sin(e.lat*s)+Math.sin(i.lat*s));a=6378137*a*6378137/2}return Math.abs(a)},readableAreaEx:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" 平方公顷":t.toFixed(2)+" 平方米":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistanceEx:function(t,e,i){var o;if(e)o=t>1e3?(t/1e3).toFixed(2)+" 千米":Math.ceil(t)+" 米";else if(t*=1.09361,t>1760)o=(t/1760).toFixed(2)+" miles";else{var a=" yd";i&&(t=3*t,a=" ft"),o=Math.ceil(t)+a}return o}}),i.Util.extend(i.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),i.Polyline.include({intersects:function(){var t,e,i,o=this._getProjectedPoints(),a=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=a-1;t>=3;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),o=i?i.length:0,a=i?i[o-1]:null,s=o-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(a,t,s,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return i+=t||0,!e||3>=i},_lineSegmentsIntersectsRange:function(t,e,o,a){var s,n,r=this._getProjectedPoints();a=a||0;for(var h=o;h>a;h--)if(s=r[h-1],n=r[h],i.LineUtil.segmentsIntersect(t,e,s,n))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),i.Polygon.include({intersects:function(){var t,e,o,a,s,n=this._getProjectedPoints();return this._tooFewPointsForIntersection()?!1:(t=i.Polyline.prototype.intersects.call(this))?!0:(e=n.length,o=n[0],a=n[e-1],s=e-2,this._lineSegmentsIntersectsRange(a,o,s,1))}}),i.MapLib.Measure={},i.MapLib.Measure.version="0.0.1",i.MapLib.Measure.Msg={TipMarker:{setText:{beginText:"begin  "},createIcon:{closeText:"&times;"},addTotalPenal:{total:" total "},setSubTotalDistTag:{total:" subtotal "}},Dist:{_getTooltipText:{start:"Click to start measure  dist.",cont:"Click to continue measure dist.",end:"Click last point to finish measure."}},Area:{_getTooltipText:{start:"Click to start measure  Area.",cont:"Click to continue measure Area.",end:"Click last point to finish measure."}},error:"<strong>Error:</strong> shape edges cannot cross!"},i.MapLib.Measure.DistMgr=i.Handler.extend({options:{},initialize:function(t,e){this._map=t,i.setOptions(this,e),this.aoMeasureHandker=[]},addHooks:function(){var t=i.MapLib.Measure.dist(this._map,this,this.options);this.oLastDist=t,this.aoMeasureHandker.push(t),t.createDist()},removeHooks:function(){this.oLastDist.removeDist()}}),i.MapLib.Measure.distMgr=function(t,e){return new i.MapLib.Measure.DistMgr(t,e)},i.MapLib.Measure.Dist=i.Class.extend({includes:i.Mixin.Events,statics:{TYPE:"DIST"},Poly:i.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},touchIcon:new i.DivIcon({iconSize:new i.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:2,opacity:1,fill:!1,clickable:!0},metric:!0,feet:!0,showLength:!0,bIsTotalDist:!0},initialize:function(t,e,o){i.Browser.touch&&(this.options.icon=this.options.touchIcon),this._oParent=e,this.options.drawError.message=i.MapLib.Measure.Msg.error,o&&o.drawError&&(o.drawError=i.Util.extend({},this.options.drawError,o.drawError)),this.type=i.MapLib.Measure.Dist.TYPE,this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,o&&o.shapeOptions&&(o.shapeOptions=i.Util.extend({},this.options.shapeOptions,o.shapeOptions)),this._oLayerGroup=i.featureGroup().addTo(t),i.setOptions(this,o)},createDist:function(){this._map&&(i.DomUtil.disableTextSelection(),this._container.focus(),this._tooltip=new i.MapLib.Tooltip(this._map),i.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._oMarkerMgr=new i.MapLib.Measure.MarkerMgr(this._map,this),this._oTipMarkerMgr=new i.MapLib.Measure.TipMarkerMgr(this._map,this,{metric:this.options.metric}),this._poly=new i.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this.initEvent())},initEvent:function(){this._mouseMarker||(this._mouseMarker=i.marker(this._map.getCenter(),{icon:i.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),i.Browser.touch||this._map.on("mouseup",this._onMouseUp,this),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("click",this._onTouch,this).on("zoomend",this._onZoomEnd,this)},removeDist:function(){i.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,i.DomEvent.off(this._container,"keyup",this._cancelDrawing,this),this._clearHideErrorTimeout(),this._oMarkerMgr.cleanUpShape(),this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._oMarkerMgr.getLen();if(e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip();var i=this._oMarkerMgr.createMarker(t);this._oTipMarkerMgr.createMarker(t,i,{className:"rule_text_box",iconAnchor:[-10,20]}),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)},completeShape:function(){this._markers.length<=1||(this.removeDist(),this.options.repeatMode&&this._oParent.enable())},deleteHandler:function(t){if(this._oMarkerMgr&&!(this._oMarkerMgr.getLen()<=0)){this._oMarkerMgr.removeMarker(t);var e=this._oMarkerMgr.getPointMarkers();this._oRtnPoly&&this._oRtnPoly.setLatLngs(e)}},clearData:function(){!this._oMarkerMgr||this._oMarkerMgr.getLen()<=0||(this._oMarkerMgr.clearData(),this._oRtnPoly&&this._oRtnPoly.setLatLngs([]))},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);return!this.options.allowIntersection&&e||!this._shapeIsValid()?void this._showErrorTooltip():(this._oTipMarkerMgr.addCloseBtn(),this._oRtnPoly=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions),this._oRtnPoly.addTo(this._oLayerGroup),this._oParent.disable(),this.options.bIsTotalDist&&this._oTipMarkerMgr.addTotalDist(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),o=this._map.layerPointToLatLng(e);this._currentLatLng=o,this._updateTooltip(o),this._updateGuide(e),this._mouseMarker.setLatLng(o),i.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(){this._map.fire("draw:drawvertex",{layers:this._markerGroup}),this._oMarkerMgr.updateFinishHandler(),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=i.point(e.clientX,e.clientY)},_onMouseUp:function(e){if(this._mouseDownOrigin){var o=i.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(o)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null},_onTouch:function(t){i.Browser.touch&&(this._onMouseDown(t),this._onMouseUp(t))},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_createMarker:function(t){var e=new i.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._oMarkerMgr?this._oMarkerMgr.getLen():0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._oMarkerMgr.getLastGeoPos()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var o,a,s,n=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),r=this.options.guidelineDistance,h=this.options.maxGuideLineLength,l=n>h?n-h:r;for(this._guidesContainer||(this._guidesContainer=i.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));n>l;l+=this.options.guidelineDistance)o=l/n,a={x:Math.floor(t.x*(1-o)+o*e.x),y:Math.floor(t.y*(1-o)+o*e.y)},s=i.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),s.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,i.DomUtil.setPosition(s,a)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,o=this.options.showLength,a=this._oMarkerMgr.getLen();return 0===a?t={text:i.MapLib.Measure.Msg.Dist._getTooltipText.start}:(e=o?this._getMeasurementString():"",t=1===a?{text:i.MapLib.Measure.Msg.Dist._getTooltipText.cont,subtext:e}:{text:i.MapLib.Measure.Msg.Dist._getTooltipText.end,subtext:e}),t},_getMeasurementString:function(){var t,e=this._currentLatLng,o=this._oMarkerMgr.getLastGeoPos();return t=this._oTipMarkerMgr.getTotalDist()+e.distanceTo(o),i.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(i.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cancelDrawing:function(t){this._map.fire("draw:canceled",{layerType:this.type}),27===t.keyCode&&this._oParent.disable()}}),i.MapLib.Measure.dist=function(t,e){return new i.MapLib.Measure.Dist(t,e)},i.MapLib.Measure.MarkerMgr=i.Class.extend({statics:{TYPE:"DIST"},options:{icon:new i.DivIcon({iconSize:new i.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),zIndexOffset:2e3},initialize:function(t,e,o){this._map=t,this._oParent=e,i.setOptions(this,o),this._dTotalDist=0,this._markers=[],this._layerGroup=i.featureGroup(),this._map.addLayer(this._layerGroup)},createMarker:function(t,e){var o=i.extend({},e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),a=new i.Marker(t,o);return this._layerGroup.addLayer(a),this._markers.push(a),a},getLen:function(){return this._markers?this._markers.length:0},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this._markers.length-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getPointMarkers:function(){var t=[];if(!this._markers||this._markers.length<=0)return t;for(var e=0;e<this._markers.length;e++)t.push(this._markers[e].getLatLng());return t},updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>=2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},cleanUpShape:function(){this._markers<=1||this.getLastMarker().off("click",this._finishShape,this)},_finishShape:function(){this._oParent._finishShape()},removeMarker:function(t){for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this._layerGroup.removeLayer(t)},updateDist:function(){for(var t=0;t<this._markers;t++)if(0!==t){var e=this._tipMarkers[t].getLatLng().distanceTo(this._tipMarkers[t-1]);this._tipMarkers[t].setDist(e)}else this._tipMarkers[t].setDist(0)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),i.MapLib.Measure.TipMarkerMgr=i.Class.extend({statics:{TYPE:"DIST"},initialize:function(t,e,o){this._map=t,i.setOptions(this,o),this._markers=[],this._layerGroup=i.featureGroup(),this._map.addLayer(this._layerGroup),this._oParent=e},options:{metric:!0},createMarker:function(t,e,o){var a=i.MapLib.Measure.tipMarker(t,this,o);a.addTo(this._layerGroup),this._markers.push(a);var s=this.getSecLastMarker(),n=this.calDist(a,s);return a.setDist(n),this._markers.length>1&&(n=this.getTotalDist(),a.setSubTotalDist(n)),e&&(a.oRelaMarker=e),a},calDist:function(t,e){if(!e)return 0;var i=t.getLatLng(),o=e.getLatLng();return i.distanceTo(o)},getTotalDist:function(){if(this._markers.length<=0)return 0;for(var t=0,e=0;e<this._markers.length;e++)t+=this._markers[e].dDist;return t},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this.getLen()-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getSecLastMarker:function(){return!this._markers||this._markers.length<=1?null:this._markers[this.getLen()-2]},getLen:function(){return this._markers?this._markers.length:0},addCloseBtn:function(){var t=this.getLastMarker();t&&t.addAllClose()},addTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.addTotalPenal(e)}},setTipTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.setTotalDist(e)}},setSubDist:function(){if(this._markers&&!(this._markers.length<=0)){this._markers[0].setDist(0),this._markers[0].deleteSubTotalTag();for(var t=1;t<this._markers.length;t++){var e=this.calDist(this._markers[t],this._markers[t-1]);this._markers[t].setDist(e)}}},setTipSubTotalDist:function(){if(this._markers&&!(this._markers.length<=0))for(var t=0,e=1;e<this._markers.length;e++)t=this._markers[e].dDist+t,this._markers[e].setSubTotalDist(t)},update:function(){this.setSubDist(),this.setTipSubTotalDist(),this._oParent.options.bIsTotalDist?this.addTotalDist():this.setTipTotalDist(),this.addCloseBtn()},removeTipMarker:function(t){if(2===this._markers.length)return this.clearData(),void this._oParent.clearData();for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this.update(),t.oRelaMarker&&this._oParent.deleteHandler(t.oRelaMarker),this._layerGroup.removeLayer(t)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},deleteDist:function(){this.clearData(),this._oParent.clearData()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),i.MapLib.Measure.TipMarker=i.Marker.extend({options:{oShowConfig:{bIsSubDist:!1,bIsSubTotalDist:!0,bIsSubClose:!0},metric:!0},oUIConfig:{oSubDist:{nOrder:1,cTagName:"span"},oSubTotalDist:{nOrder:2,cTagName:"span"},oTotalDist:{nOrder:3,cTagName:"span"},oSubClose:{nOrder:4,cTagName:"a",cClassName:"ex-dist-close ec-text-lg",cText:"",cHtml:i.MapLib.Measure.Msg.TipMarker.createIcon.closeText,bIsClick:!0},oTotalClose:{nOrder:5,cTagName:"a",cClassName:"ex-dist-close ec-icon-trash",cText:"",cHtml:""}},initialize:function(t,e,o){i.Util.extend(this.oUIConfig,o.oUIConfig);for(var a in this.oUIConfig)"span"===this.oUIConfig[a].cTagName&&(this.oUIConfig[a].metric=this.options.metric);i.Marker.prototype.initialize.call(this,t,o),this._oParent=e,this.aoTag=[]},_initIcon:function(){var t=this.options,e=this._map,o=e.options.zoomAnimation&&e.options.markerZoomAnimation,a=o?"leaflet-zoom-animated":"leaflet-zoom-hide",s=this.createIcon();i.DomUtil.addClass(s,a),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),t.opacity<1&&this._updateOpacity();var n=this._map._panes;n.markerPane.appendChild(this._icon)},_setIconStyles:function(t,e){var o,a=this.options,s=i.point(a[e+"Size"]);o=i.point(a.iconAnchor),!o&&s&&(o=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+a.className,o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},createIcon:function(){var t=i.DomUtil.create("div","");return this._setIconStyles(t,"icon"),this.oTagContanier=t,this.createTag(),t},createTag:function(){var t=this.options.oShowConfig;for(var e in t)if(t[e]){var o=e.replace("bIs","o");if(this.oUIConfig.hasOwnProperty(o)){var a=new i.MapLib.Measure.TipTag(this,this.oUIConfig[o]);a.setFlag(o),this.addTag(a),this.oUIConfig[o].bIsClick&&a.setClick(this.closeHanler,this)}}},addTag:function(t){var e=this.aoTag;if(e.length<=0)return e.push(t),void this.oTagContanier.appendChild(t.oTag);for(var i=e.length,o=0;o<e.length;o++)if(t.nOrder<e[o].nOrder){i=o;break}i===e.length?(this.oTagContanier.appendChild(t.oTag),this.aoTag.push(t)):(this.oTagContanier.insertBefore(t.oTag,this.aoTag[i].oTag),this.aoTag.splice(i,0,t))},addAllClose:function(){var t=this.getTagByFlag("oTotalClose");t||(t=i.MapLib.Measure.tipTag(this,this.oUIConfig.oTotalClose),t.setFlag("oTotalClose"),this.addTag(t),t.setClick(function(){this._oParent.deleteDist()},this))},deleteTag:function(t){var e=this.aoTag;if(e&&!(e.length<=0))for(var i=0;i<e.length;i++)if(e[i].cFlag===t){this.oTagContanier.removeChild(e[i].oTag),e.splice(i,1);break}},deleteSubTotalTag:function(){this.deleteTag("oSubTotalDist")},addTotalPenal:function(t){var e=this.getTagByFlag("oTotalDist");e||(e=i.MapLib.Measure.tipTag(this,this.oUIConfig.oTotalDist),e.setFlag("oTotalDist"),this.addTag(e)),this.setTotalDist(t,e)},setTotalDist:function(t,e){if(e||(e=this.getTagByFlag("oTotalDist")),e){this.deleteTag("oSubTotalDist");var o=i.MapLib.Measure.Msg.TipMarker.addTotalPenal.total;e.setHTML(t,o)}},setDist:function(t){this.dDist=t;var e=this.getTagByFlag("oSubDist");e&&e.setHTML(t)},getTagByFlag:function(t){var e=this.aoTag;if(!e||e.length<=0)return void 0;for(var i=0;i<e.length;i++)if(e[i].cFlag===t)return e[i];return void 0},setSubTotalDist:function(t){var e=this.getTagByFlag("oSubTotalDist");if(e){var o=i.MapLib.Measure.Msg.TipMarker.setSubTotalDistTag.total;e.setHTML(t,o)}},closeHanler:function(){this._oParent.removeTipMarker(this)}}),i.MapLib.Measure.tipMarker=function(t,e,o){return new i.MapLib.Measure.TipMarker(t,e,o)},i.MapLib.Measure.TipTag=i.Class.extend({options:{cTagName:"span",cClassName:"",nOrder:1,cText:""},initialize:function(t,e){i.setOptions(this,e),this._oParent=t,this.createTag()},createTag:function(){var t=i.DomUtil.create(this.options.cTagName,"");return this.nOrder=this.options.nOrder,this.options.cClassName&&i.DomUtil.addClass(t,this.options.cClassName),t.text=this.options.cText,t.innerHTML=this.options.cHtml||"",this.oTag=t,t},setFlag:function(t){this.cFlag=t,this.oTag.setAttribute("cFlag",t)},setHTML:function(t,e){if("string"==typeof t)return void(this.oTag.innerText=t);var o=i.MapLib.Measure.Msg.TipMarker.setText.beginText;0!==t&&(o=i.GeometryUtil.readableDistanceEx(t,this.options.metric)),this.oTag.innerHTML=(e||"")+o},setClick:function(t,e){i.DomEvent.on(this.oTag,"click",t,e)}}),i.MapLib.Measure.tipTag=function(t,e){return new i.MapLib.Measure.TipTag(t,e)},i.MapLib.Measure.AreaMgr=i.MapLib.Measure.DistMgr.extend({addHooks:function(){var t=i.MapLib.Measure.area(this._map,this,this.options);this.oLastDist=t,this.aoMeasureHandker.push(t),t.createDist()}}),i.MapLib.Measure.areaMgr=function(t,e){return new i.MapLib.Measure.AreaMgr(t,e)},i.MapLib.Measure.Area=i.MapLib.Measure.Dist.extend({statics:{TYPE:"area"},Poly:i.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:2,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e,o){i.MapLib.Measure.Dist.prototype.initialize.call(this,t,e,o),this.type=i.MapLib.Measure.Area.TYPE},createDist:function(){this._map&&(i.DomUtil.disableTextSelection(),this._container.focus(),this._tooltip=new i.MapLib.Tooltip(this._map),i.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._oMarkerMgr=new i.MapLib.Measure.AreaMarkerMgr(this._map,this),this._oTipMarkerMgr=new i.MapLib.Measure.AreaTipMarkerMgr(this._map,this),this._poly=new i.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this.initEvent())},_getTooltipText:function(){var t,e,o=this._oMarkerMgr.getLen();return 0===o?t=i.MapLib.Measure.Msg.Area._getTooltipText.start:3>o?t=i.MapLib.Measure.Msg.Area._getTooltipText.cont:(t=i.MapLib.Measure.Msg.Area._getTooltipText.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?i.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){var t=this._oMarkerMgr.getLen();return t>=3},_vertexChanged:function(t,e){var o;!this.options.allowIntersection&&this.options.showArea&&(o=this._poly.getLatLngs(),this._area=i.GeometryUtil.geodesicArea(o)),i.MapLib.Measure.Dist.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),i.MapLib.Measure.area=function(t,e,o){return new i.MapLib.Measure.Area(t,e,o)},i.MapLib.Measure.AreaMarkerMgr=i.MapLib.Measure.MarkerMgr.extend({updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))}}),i.MapLib.Measure.AreaTipMarkerMgr=i.MapLib.Measure.TipMarkerMgr.extend({statics:{TYPE:"AREA"},createMarker:function(t,e,o){var a=new i.MapLib.Measure.AreaTipMarker(t,this,o);return a.addTo(this._layerGroup),this._markers.push(a),e&&(a.oRelaMarker=e),a},getTotalDist:function(){if(this._markers.length<=2)return 0;var t=this._markers.map(function(t){return t.getLatLng()}),e=i.GeometryUtil.geodesicArea(t);return e},removeTipMarker:function(t){if(3===this._markers.length)return this.clearData(),void this._oParent.clearData();for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this.update(),t.oRelaMarker&&this._oParent.deleteHandler(t.oRelaMarker),this._layerGroup.removeLayer(t)},update:function(){this._oParent.options.bIsTotalDist?this.addTotalDist():this.setTipTotalDist(),this.addCloseBtn()}}),i.MapLib.Measure.AreaTipMarker=i.MapLib.Measure.TipMarker.extend({oUIConfig:{oTotalDist:{nOrder:3,cTagName:"span"},oSubClose:{nOrder:4,cTagName:"a",cClassName:"ex-dist-close ec-text-lg",cText:"",cHtml:i.MapLib.Measure.Msg.TipMarker.createIcon.closeText,bIsClick:!0},oTotalClose:{nOrder:5,cTagName:"a",cClassName:"ex-dist-close ec-icon-trash",cText:"",cHtml:""}},createTag:function(){var t=this.options.oShowConfig;for(var e in t)if(t[e]){var o=e.replace("bIs","o");if(this.oUIConfig.hasOwnProperty(o)){var a=new i.MapLib.Measure.AreaTipTag(this,this.oUIConfig[o]);a.setFlag(o),this.addTag(a),this.oUIConfig[o].bIsClick&&a.setClick(this.closeHanler,this)}}},addTotalPenal:function(t){var e=this.getTagByFlag("oTotalDist");e||(e=new i.MapLib.Measure.AreaTipTag(this,this.oUIConfig.oTotalDist),e.setFlag("oTotalDist"),this.addTag(e)),this.setTotalDist(t,e)}}),i.MapLib.Measure.AreaTipTag=i.MapLib.Measure.TipTag.extend({setHTML:function(t){if("string"==typeof t)return void(this.oTag.innerText=t);
var e=i.MapLib.Measure.Msg.TipMarker.setText.beginText;0!==t&&(e=i.GeometryUtil.readableAreaEx(t,this.options.metric)),this.oTag.innerHTML=e}}),i.MapLib.LocaltionSearch={},i.MapLib.LocaltionSearch.version="0.0.1",i.MapLib.LocaltionSearch.Msg={addHooks:{locText:"move mouse to search localtion"},_onMouseMove:{locTemp:"lng:{lng},lat:{lat}"}},i.MapLib.LocaltionSearch.Search=i.Handler.extend({statics:{TYPE:"LocaltionSearch"},includes:i.Mixin.Events,initialize:function(t,e){i.Handler.prototype.initialize.call(this,t),i.setOptions(this,e),this._uneditedLayerProps={}},enable:function(){this._enabled||(this.fire("enabled",{handler:this.type}),this._map.fire("tool:localStart",{handler:this.type}),i.Handler.prototype.enable.call(this))},disable:function(){this._enabled&&(i.Handler.prototype.disable.call(this),this._map.fire("tool:localStop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._tooltip=new i.MapLib.Tooltip(this._map),this._tooltip.updateContent({text:"",subtext:i.MapLib.LocaltionSearch.Msg.addHooks.locText}),i.DomUtil.addClass(this._map.getContainer(),"toopTipClass"),this._map.on("mousemove",this._onMouseMove,this).on("click",this._onClick,this))},removeHooks:function(){this._map&&(this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,i.DomUtil.removeClass(this._map.getContainer(),"toopTipClass"),this._map.off("mousemove",this._onMouseMove,this).off("click",this._onClick,this))},_onClick:function(t){var o=this._map.getContainer(),a=i.DomUtil.create("input","",o);a.type="text";var s={lat:t.latlng.lat.toFixed(6),lng:t.latlng.lng.toFixed(6)};a.value=i.Util.template(i.MapLib.LocaltionSearch.Msg._onMouseMove.locTemp,s),a.select(),e.execCommand("Copy"),o.removeChild(a),this.disable()},_onMouseMove:function(t){var e={lat:t.latlng.lat.toFixed(6),lng:t.latlng.lng.toFixed(6)};this._tooltip.updateContent({text:i.MapLib.LocaltionSearch.Msg.addHooks.locText,subtext:i.Util.template(i.MapLib.LocaltionSearch.Msg._onMouseMove.locTemp,e)}),this._tooltip.updatePosition(t.latlng)}}),i.Map.mergeOptions({rectBox:!1}),i.Map.RectBox=i.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){i.DomEvent.on(this._container,"mousedown",this._onMouseDown,this),i.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.dragging.disable()},removeHooks:function(){i.DomEvent.off(this._container,"mousedown",this._onMouseDown,this),i.DomUtil.removeClass(this._container,"leaflet-crosshair")},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){this._resetState(),i.DomUtil.disableTextSelection(),i.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),"0.7.7"===i.version?i.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this):i.DomEvent.on(e,{contextmenu:i.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=i.DomUtil.create("div","leaflet-zoom-box",this._container),this._map.fire("rectboxstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new i.Bounds(this._point,this._startPoint),o=e.getSize();i.DomUtil.setPosition(this._box,e.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&("0.7.7"===i.version?(this._container.removeChild(this._box),this._container.style.cursor=""):(i.DomUtil.remove(this._box),i.DomUtil.removeClass(this._container,"leaflet-crosshair"))),this._map.dragging.enable(),i.DomUtil.enableTextSelection(),i.DomUtil.enableImageDrag(),"0.7.7"===i.version?i.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown):i.DomEvent.off(e,{contextmenu:i.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(i.bind(this._resetState,this),0);var e=new i.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fire("rectboxend",{boxBounds:e}),this.endHandler(e)}},endHandler:function(){},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),i.Map.addInitHook("addHandler","rectBox",i.Map.RectBox),i.Map.ScaleBig=i.Map.RectBox.extend({endHandler:function(t){t&&(this._map.fitBounds(t),this.disable())}}),i.Map.ScaleSmall=i.Map.RectBox.extend({endHandler:function(t){t&&(this.zoomInBounds(t),this.disable())},zoomInBounds:function(t,e){var o=this._map.getZoom();e=e||{},t=t.getBounds?t.getBounds():i.latLngBounds(t);var a=i.point(e.paddingTopLeft||e.padding||[0,0]),s=i.point(e.paddingBottomRight||e.padding||[0,0]),n=this._map.getBoundsZoom(t,!1,a.add(s)),r=s.subtract(a).divideBy(2),h=this._map.project(t.getSouthWest(),n),l=this._map.project(t.getNorthEast(),n),p=this._map.unproject(h.add(l).divideBy(2).add(r),n),c=n-o===0?1:n-o;return n=e&&e.maxZoom?Math.min(e.maxZoom,n):o-c,this._map.setView(p,n,e)}}),i.Util.extend(i.LineUtil,{initTag:function(t,e){if(t&&e)for(var o in e)if(i.Util.isArray(e[o]))for(var a=o,s=0;s<e[a].length;s++){var n=i.DomUtil.create(a);this.initTag(n,e[a][s]),t.appendChild(n)}else if("object"==typeof e[o]&&null!==e[o]){var r=i.Util.replaceAll(o,"1",""),h=i.DomUtil.create(r);this.initTag(h,e[o]),t.appendChild(h)}else if("html"===o){var l=t.innerHTML;t.innerHTML=l+(null!==e[o]?e[o]:"")}else t.setAttribute(o,e[o])},replaceAll:function(t,e,i){return t.replace(new RegExp(e,"gm"),i)}}),i.MapLib.MapMaster={},i.MapLib.MapMaster.vertion="0.0.1",i.MapLib.MapMaster.TileProvider={oTianDiTu:{oNormal:{cName:"天地图",cMap:"http://t{s}.tianditu.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oSatellite:{cName:"天地卫星图",cMap:"http://t{s}.tianditu.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oTerrain:{cName:"天地地形图",cMap:"http://t{s}.tianditu.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]}},oMapABC:{oNormal:{cName:"MapABC",cMap:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",acSubdomains:["a","b","c"]}},oGaoDe:{oNormal:{cName:"高德地图",cMap:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"高德卫星图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oNetRoad:{cName:"高德路网图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]}},oExSun:{oNormal:{cName:"依迅本地图",cMap:"http://192.168.1.248:9000/map/get/{x}/{y}/{z}",acSubdomains:["1","2","3","4"]},oNormalSvr:{cName:"依迅服务器图",cMap:"http://221.235.53.42:8008/mapimg.aspx?t=mapabc&z={z}&x={x}&y={y}",acSubdomains:["1","2","3","4"]}},oGoogleMap:{oNormal:{cName:"谷歌地图",cMap:"http://mt2.google.cn/vt/lyrs=m@167000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"谷歌卫星图",cMap:"http://mt3.google.cn/vt/lyrs=s&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oTopographic:{cName:"谷歌地形图",cMap:"http://mt0.google.cn/vt/lyrs=t&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",nMaxLevel:16,acSubdomains:["1","2","3","4"]}},oArcMap:{oFoursquare:{cMap:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",cName:"灰度图",acSubdomains:["1","2","3","4"]}},oTDMap:{oNormal:{cName:"立体图",cMap:"https://a.tiles.mapbox.com/v3/foursquare.map-0y1jh28j/{z}/{x}/{y}.png",acSubdomains:["1","2","3","4"]}}},i.MapLib.MapMaster.TileProvider[0]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oNormal,i.MapLib.MapMaster.TileProvider[1]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oSatellite,i.MapLib.MapMaster.TileProvider[2]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oTerrain,i.MapLib.MapMaster.TileProvider[3]=i.MapLib.MapMaster.TileProvider.oMapABC.oNormal,i.MapLib.MapMaster.TileProvider[4]=i.MapLib.MapMaster.TileProvider.oGaoDe.oNormal,i.MapLib.MapMaster.TileProvider[5]=i.MapLib.MapMaster.TileProvider.oGaoDe.oSatellite,i.MapLib.MapMaster.TileProvider[6]=i.MapLib.MapMaster.TileProvider.oGaoDe.oNetRoad,i.MapLib.MapMaster.TileProvider[7]=i.MapLib.MapMaster.TileProvider.oExSun.oNormal,i.MapLib.MapMaster.TileProvider[8]=i.MapLib.MapMaster.TileProvider.oExSun.oNormalSvr,i.MapLib.MapMaster.TileProvider[9]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oNormal,i.MapLib.MapMaster.TileProvider[10]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oSatellite,i.MapLib.MapMaster.TileProvider[11]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oTopographic,i.MapLib.MapMaster.TileProvider[12]=i.MapLib.MapMaster.TileProvider.oArcMap.oFoursquare,i.MapLib.MapMaster.TileProvider[13]=i.MapLib.MapMaster.TileProvider.oTDMap.oNormal,i.MapLib.MapMaster.Err={1:"没有设置图层！",2:"Map parent container not found."},i.MapLib.MapMaster.Map=i.Evented.extend({options:{cDidId:"divMap",cDivContainerId:"divContainer",nDefaultTile:4,oMapOption:{zoomControl:!1,layers:[],center:new i.LatLng(30.55072,114.29471),zoom:10},oTileOption:{maxZoom:18,minZoom:3,attribution:'Map &copy;GB-20263—2018 <a target="_blank" href="#">浩宇天辰</a> '},anLoadTile:[4,5,6,9,10,11,12],oProvider:i.MapLib.MapMaster.TileProvider,nMapWidth:600,nMapHeight:500},cDiv:"div",initialize:function(t,e){return i.setOptions(this,e),this._oParent=t,this._oBaseLayer={},this._oDefaultTile=void 0,this._initTile(),this._getDefaultLayer(),this},getDefaultTile:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oBaseLayer[t]},loadMapMaster:function(){return this._loadMap(),this},getMap:function(){return this._oMap},getBaseLayers:function(){if(!this._oBaseLayer)throw new Error(i.MapLib.MapMaster.Err[1]);return this._oBaseLayer},_getDefaultLayer:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oDefaultTile=this._oBaseLayer[t],this._oDefaultTile},_loadMap:function(){var t=i.DomUtil.get(this.options.cDidId),e=this.options.nMapWidth,o=this.options.nMapHeight;if(!t){var a=i.DomUtil.get(this.options.cDivContainerId);if(!a)throw new Error(i.MapLib.MapMaster.Err[2]);t=i.DomUtil.create(this.cDiv,"",a)}t.style.width=e+"px",t.style.height=o+"px",t.id=this.options.cDidId,i.Util.extend(this.options.oMapOption,{layers:[this._oDefaultTile]});var s=this._oMap=new i.Map(this.options.cDidId,this.options.oMapOption);return this._oParent&&(this._oParent.setMap&&this._oParent.setMap(s),this._oParent.fire("Map:loadFinish",{oMap:s}),this.fire("Map:loadFinish",{oMap:s})),s},_initTile:function(){var t=i.extend({},this.options.oTileOption),e=this.options.oProvider,o=this.options.anLoadTile;if(o&&!(o.length<=0)&&e){for(var a={},s=0;s<o.length;s++){var n=e[o[s]];t.maxZoom=n.nMaxLevel||t.maxZoom,t.minZoom=n.nMinLevel||t.minZoom,t.subdomains=n.acSubdomains;var r=i.tileLayer(n.cMap,t);a[n.cName]=r}this._oBaseLayer=a,this._oParent.fire("Map:loadTileFinish",{oBaseLayer:a}),this.fire("Map:loadTileFinish",{oBaseLayer:a})}},reflesh:function(t,e){if(this._oMap){var i=this._oMap.getContainer();t&&(i.style.width=t+"px"),e&&(i.style.height=e+"px"),this._oMap._onResize()}}}),i.MapLib.MapMaster.Map.include({cTopLeftConfig:{div:{"class":"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},cTopRightConfig:{div:{"class":"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},initTopLeft:function(t){var e=i.DomUtil.get(this.options.cDidId);e&&(t?i.Util.initTag(e,t):i.Util.initTag(e,this.cTopLeftConfig))},initTopRight:function(){}}),i.MapLib.MapMaster.MapOpr=i.Evented.extend({options:{nFlyZoom:10,nFlyDuration:3,nFlyMaxZoom:15,cFlayMapVertion:"1.0"},initialize:function(t,e){e=i.setOptions(this,e),this._oParent=t,t&&(t._oMap?this._oMap=t._oMap:t instanceof i.Map?this._oMap=t:t.on&&t.on(i.MapLib.MapMaster.EventName.loadFinish,this.setMap,this)),this._initOn()},flyTo:function(t,e){if(this._oMap){var o=null;if(t.hasOwnProperty("oGpsInfo")){var a=t.oGpsInfo;o=i.latLng(a.Lat,a.Lon)}if(t instanceof i.LatLng&&(o=t),t.hasOwnProperty("lat")&&t.hasOwnProperty("lng")&&(o=i.latLng(t.lat,t.lng)),t.hasOwnProperty("Lat")&&t.hasOwnProperty("Lng")&&(o=i.latLng(t.Lat,t.Lng)),!(i.version<this.options.cFlayMapVertion))return this._oMap.getBounds().contains(o)&&this._oMap.getZoom()>=this.options.nFlyMaxZoom?void this._oMap.panTo(o):(this._oMap.flyTo(o,e.zoom||this.options.nFlyZoom,{duration:e.duration||this.options.nFlyDuration}),this)}},reflesh:function(){return this._oMap?(this._oMap._onResize(),this):void 0},findLayer:function(t,e){if(!t||t.getLayers().length<=0)return null;var i=t.getLayers();for(var o in i)if(i[o].cId===e)return i[o];return null},findLayerInMap:function(t){if(!this._oMap)return null;var e=this._oMap._layers;if(!e)return null;var i=[];for(var o in e)e[o].cId===t&&i.push(e[o]);return i},posInSrceen:function(t){if(!this._oMap)return!1;var e=this._oMap.getBounds();return e.contains(t)},_drawTip:function(t,e){var o={cId:"1",cName:"测试tip",bNoHide:!0};i.Util.extend(o,e);var a=new i.DivIcon({html:"<div> </div>",className:""}),s=i.marker(t,{icon:a,bIsNotEdit:!0});return s.cId="TM_"+o.cId,s.bindLabel(o.cName,{noHide:o.bNoHide,direction:"auto"}),s},setMap:function(t){return this._oMap=t,this},delPosNotInScreen:function(t,e){if(t&&!(t.length<=0)){e||(e=this.oMap.getBounds());for(var o=t.length-1;o>=0;o--){var a=i.latLng(t[o].oLatLng.lat,t[o].oLatLng.lng);e.contains(a)||t.splice(o,1)}return this}},_loadPage:function(){},_initOn:function(){}})}(window,document,L);